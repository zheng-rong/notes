<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="generator" content="ReText 4.1.2">
<title>setup_laptop</title>
</head>
<body>
<h1><center> Set up your laptop in Ubuntu</h1>
<p><center><big><em>Zheng Rong  @ Dec. 5 2014</em></big></p>
<p><center><img alt="text" src="image/logo.gif"></p>
<p><a href="abcde">link text</a></p>
<hr>
<h2>install Ubuntu</h2>
<pre><code>    sudo apt-get update
    sudo apt-get upgrade
</code></pre>
<hr>
<h2>input method</h2>
<pre><code>    language support    
    text entry setting  
    preference setting
</code></pre>
<hr>
<h2>Set/update time and date</h2>
<ul>
<li>update with Internet<pre><code>sudo ntpdate time.nist.gov
</code></pre>
</li>
</ul>
<p><em>other servers include time.windows.com, <a href="http://www.pool.ntp.org/">here</a> lists time servers around the world.</em></p>
<ul>
<li>set
        sudo date --set "25 Sep 2013 15:00:00"<br>
        sudo date 010224311971.59 <br>
        sudo date --set="1971-01-02 24:31:59.990"  &amp;&amp; date --rfc-3339=ns    </li>
</ul>
<hr>
<p><a name="abcde"/></p>
<h2>Commands about packages</h2>
<p>find the installed packages: (example yaml)</p>
<pre><code>    dpkg --get-selections | grep yaml
</code></pre>
<p>show the information about a package</p>
<pre><code>    dpkg -s package-name
</code></pre>
<p>To get a list of packages installed locally</p>
<pre><code>    dpkg --get-selections | grep -v deinstall
</code></pre>
<p>To save that list to a text file </p>
<pre><code>    dpkg --get-selections | grep -v deinstall &gt; ~/Desktop/packages
</code></pre>
<hr>
<h2>set up the bash</h2>
<p><a href="https://help.ubuntu.com/community/CustomizingBashPrompt">REF</a> </p>
<p><a href="dot-bashrc">using the attached file</a></p>
<pre><code>gedit ~/.bashrc
</code></pre>
<blockquote>
<p>uncomment the line   <br>
from<br>
    #force_color_prompt=yes   <br>
to<br>
    force_color_prompt=yes</p>
</blockquote>
<hr>
<h2>install logitech unifying</h2>
<pre><code>    sudo add-apt-repository ppa:daniel.pavel/solaar
    sudo apt-get update
    sudo apt-get install solaar
</code></pre>
<hr>
<h2>install　ROS</h2>
<p><a href="www.ros.org">ROS</a></p>
<hr>
<h2>install vim</h2>
<pre><code>    sudo apt-get install vim
</code></pre>
<p><em>set up the vim</em>   </p>
<ul>
<li>
<p>create (or edit) the .vimrc file:   </p>
<pre><code>vim ~/.vimrc
</code></pre>
</li>
<li>
<p>paste the configuration below into the file.   </p>
<pre><code>set tabstop=4       " The width of a TAB is set to 4.
                    " Still it is a \t. It is just that
                    " Vim will interpret it to be having
                    " a width of 4.
set shiftwidth=4    " Indents will have a width of 4
set softtabstop=4   " Sets the number of columns for a TAB
set expandtab       " Expand TABs to spaces
" set nu
syntax on
set autoindent      " auto indent
</code></pre>
</li>
<li>
<p>restart vim</p>
</li>
</ul>
<hr>
<h2>install sublime-text-3</h2>
<pre><code>    sudo add-apt-repository ppa:webupd8team/sublime-text-3
    sudo apt-get update
    sudo apt-get install sublime-text-installer
</code></pre>
<hr>
<h2>install others</h2>
<pre><code>    sudo apt-get install tex-live
    sudo apt-get install tex-maker
    sudo apt-get install skype
    sudo apt-get install dropbox
    sudo apt-get install everpad
    sudo apt-get install Gparted
    sudo apt-get install partitionmanager
    sudo apt-get install retext
</code></pre>
<p><em>retext is a editor based on Markdown</em> 
<a href="https://github.com/LearnShare/Learning-Markdown">how to use retex</a></p>
<hr>
<h2>follow Ellen's note</h2>
<h3>install packages</h3>
<pre><code>    sudo apt-get install swig
    sudo apt-get install openjdk-7-jdk
    sudo apt-get install flex
    sudo apt-get install libboost-all-dev libboost-dev
    sudo apt-get install libgsl0-dev
    sudo apt-get install libeigen3-dev 
    sudo apt-get install libatlas-dev
    sudo apt-get install libatlas-base-dev
    sudo apt-get install libatlas3gf-base
</code></pre>
<p><big>install Armadillo</big></p>
<p>…by downloading it from the website, not via apt-get, and follow the instructions in the readme. Make sure to do all the –devs and parallel stuff it mentions.</p>
<p>http://arma.sourceforge.net/download.html</p>
<p>sudo apt-get install liblapack-dev liblapack3gf liblapack-pic liblapack-test</p>
<p>sudo apt-get install libarpack++2-dev libarpack++2c2a libarpack2 libarpack2-dbg libarpack2-dev</p>
<p>Update: Do NOT install OpenBLAS. 
OpenBLAS has a multi-threading affinity which results in the creation of threads when solving certain classes of problems. Unfortunately, this results in high overhead as the system rapidly creates, clones, and yields numerous threads. This issue is linux specific.</p>
<p><big>install yaml-cpp package</big></p>
<p>Again, download “yaml-cpp_0.5.1.tar.gz” from their website and install using the readme.</p>
<p>https://code.google.com/p/yaml-cpp/ </p>
<h3>install bison</h3>
<p>Go to <a href="http://ftp.gnu.org/gnu/bison">gnu project archives</a><br>
download the “bison-2.5.tar.gz”</p>
<pre><code>sudo apt-get install m4
</code></pre>
<p>go into bison-2.5/lib, open stdio.in.h, and find the following lines:</p>
<pre><code>/* It is very rare that the developer ever has full control of
stdin, so any use of gets warrants an unconditional warning.
Assume it is always declared, since it is required by C89.  */
#if defined gets
#undef gets
_GL_WARN_ON_USE (gets, "gets is a security hole - use fgets 
instead");
#endif
</code></pre>
<p>Comment out or delete the above lines. Finally,</p>
<pre><code>./configure
make
sudo make install
</code></pre>
<h3>install IPC</h3>
<p>Download IPC &amp; unpack it.
<a href="http://www.cs.cmu.edu/~./IPC/">IPC</a></p>
<p>Change IPC flag</p>
<p>set -fPIC flag as described on <a href="https://github.com/nmichael/ipc_bridge">ipc_bridge doc</a></p>
<p>Find the ipc-3.9.1/etc/GNUmakefile.defs file.</p>
<p>Go to line 371.</p>
<p>Change:</p>
<pre><code>$(CFLAGSM_$(DBMALLOC)) $(CFLAGS_EXT)
</code></pre>
<p>to be</p>
<pre><code>$(CFLAGSM_$(DBMALLOC)) $(CFLAGS_EXT) -fPIC
</code></pre>
<p>Now, Install IPC</p>
<pre><code>sudo make
</code></pre>
<p>(There are some errors displayed earlier in the make, but these do not appear to break the components we need)</p>
<p>manually copy some files to new folders</p>
<p>ipc3.9.<em>/{bin/Linux</em>, lib/Linux*, include} to /opt/ipc/{bin,lib,include} </p>
<p>NOTE: <br>
Do NOT add "LINUX*" directory in the destination directory when copying files from ipc     </p>
<pre><code>ipc3.9.*/{bin/Linux*, lib/Linux*, include}
</code></pre>
<p>to  </p>
<pre><code>/opt/ipc/{bin,lib,include}
</code></pre>
<h3>install Matlab</h3>
<p>use your own Matlab install file</p>
<hr>
<h2>setup printer in FRC.RI.CMU</h2>
<p>If you have an SCS account there are several ways to print:</p>
<p>The prefered method is here.  <br>
In linux (Ubuntu):<br>
Go to System -&gt; Administration -&gt; Printing    <br>
Click 'Add' 
Expand 'Network Printer'  <br>
Select 'LPD/LPR Host or Printer'     <br>
change the Host and Queue fields. Queue is the name of the printer.</p>
<h4>Printer IP  FQDN    Model   Location    Host</h4>
<pre><code>boulder 
128.2.177.195   
boulder.prt.cs.cmu.edu  
HP Color Laserjet 5550N 
NSH 1100 (near FRC mailboxes)   
cyan.srv.cs.cmu.edu

lightning   
128.2.177.194   
lightning.prt.cs.cmu.edu    
HP Laserjet 9000N   
NSH 1200 (near e-lab)   
cyan.srv.cs.cmu.edu

mulch   
128.2.177.211   
mulch.prt.cs.cmu.edu    HP Laserjet 4350n   
NSH 2200 (near FRC grad student offices and water cooler)   
cyan.srv.cs.cmu.edu

prismCOLOR  
128.2.177.208   
prismcolor.prt.cs.cmu.edu   
HP Color Laserjet 5550DN    
NSH 1509 (near NSH 1st floor copy room and RoboLounge)
cyan.srv.cs.cmu.edu
</code></pre>
<hr>
<h2>install system monitor</h2>
<pre><code>    sudo add-apt-repository ppa:fossfreedom/indicator-sysmonitor
    sudo apt-get update
    sudo apt-get install indicator-sysmonitor
    sudo apt-get remove indicator-sysmonitor # to remove indicator sysmonitor
    sudo apt-get install indicator-multiload
</code></pre>
<hr>
<h2>use GitHub</h2>
<h3>ssh key</h3>
<pre><code>    ls -al ~/.ssh
    ssh-keygen -t rsa -C "your_email@example.com"
</code></pre>
<p><em>start the ssh-agent in the background</em>
        eval "$(ssh-agent -s)"
        ssh-add ~/.ssh/id_rsa</p>
<h3>command set</h3>
<pre><code>    git add file-name
    git commit -m "commit message"
    git push

    git rm file-name
    git commit -m "remove a file"
    git push

    modify file-1
    git commit file-1 -m "modify this file"
    git push

    git add file-names
    git commit -a -m "creat"
    git push

    git status
    git checkout .
    git  pull
</code></pre>
<hr>
<h2>Wiki of px4</h2>
<p><a href="https://pixhawk.org/dev/px4_quickstart">px4 quick start</a></p>
<h3>NuttShell (NSH) via Seiral using the kermit:</h3>
<p><a href="https://pixhawk.org/users/serial_connection">Ref</a></p>
<pre><code>    sudo apt-get install ckermit
    *Set your default settings to the correct settings for px4:*  
    echo "SET LINE /dev/ttyUSB0
    SET SPEED 57600
    SET CARRIER-WATCH OFF
    SET FLOW-CONTROL NONE" &gt; ~/.kermrc

    ~/.kermrc
    ls /dev/ttyUSB*     
    sudo kermit
    connect
    enter
</code></pre>
<p><em>command:</em>  </p>
<pre><code>    ls 
    free 
    cd
</code></pre>
<p><em>quit:</em> </p>
<pre><code>    Ctrl+\  
    C   
    quit
</code></pre>
<h3>build and flash the firmware</h3>
<pre><code>    cd ~/src
    git clone https://github.com/PX4/Firmware
    cd Firmware
*GitLab special start*
    git clone git@nmichael.frc.ri.cmu.edu:px4/px4_patches.git
    git checkout -b cmu_develop `cat px4_patches/px4_master_hash`
    git apply --ignore-space-change --ignore-whitespace px4_patches/px4_master_to_cmu_develop_version.diff
    rm -fr src/modules/cmu_rc_command src/modules/cmu_pwm_command src/modules/cmu_attitude_estimator_so3 src/modules/cmu_voltage_monitor
    git submodule add git@nmichael.frc.ri.cmu.edu:px4/cmu_rc_command.git src/modules/cmu_rc_command
    git submodule add git@nmichael.frc.ri.cmu.edu:px4/cmu_voltage_monitor.git src/modules/cmu_voltage_monitor
    git submodule add git@nmichael.frc.ri.cmu.edu:px4/cmu_attitude_estimator_so3.git src/modules/cmu_attitude_estimator_so3
    git clone https://github.com/PX4/NuttX
*GitLab special end*

    git submodule init
    git submodule update

*GitLab special*
    vim makefiles/config_px4fmu-v1_default.mk

change line 129:
From:
MODULES                += modules/cmu_pwm_command
To:
#MODULES                += modules/cmu_pwm_command

    cd ~/src/Firmware
    make distclean
    make archives
    make
    sudo usermod -a -G dialout $USER
    *Log out and log in in linux for changes to take effect. (Very Important!)*
    make upload px4fmu-v1_default
</code></pre>
<p>The result should be:</p>
<pre><code>    working in [...]/Firmware/Images    
    Attempting to flash PX4FMU board via USB    
    Loaded firmware for 5,0, waiting for the bootloader...
</code></pre>
<p>When you see “waiting for the bootloader” press the “reset” button on the side of the PX4FMU. If the board is now connected &amp; reset, the new firmware will be flashed.  </p>
<pre><code>    Found board 5,0 on /dev/tty...  
    erase...    
    program...  
    verify...   
    done, rebooting.
</code></pre>
<h3>Troubleshooting</h3>
<h4>Board not found (Affects mostly Ubuntu 12.10 users)</h4>
<p>In case the board is not found, make sure you remove the modem-manager by:  </p>
<pre><code>    sudo apt-get remove modemmanager
</code></pre>
<h4>Permission Denied</h4>
<p>If you have no permissions for /dev/ttyACM0 , make sure the user is in group dialout (as described above).      </p>
<pre><code>    sudo usermod -a -G dialout $USER
</code></pre>
<p>Log out and log in in linux for changes to take effect. (Very Important!)</p>
<h4>To find out the device name (if not /dev/ttyACM0), do a</h4>
<pre><code>    ls /dev/tty*
</code></pre>
<p>when the bootloader is loading (first 5 seconds after reset).</p>
<h3>install Qground control</h3>
<p><a href="http://qgroundcontrol.org/dev/build_source">Qgroundcontrol</a></p>
<p><a href="https://github.com/mavlink/qgroundcontrol.git">github</a></p>
<p><a href="https://github.com/mavlink/qgroundcontrol/blob/master/README.md">installation instruction</a></p>
<h3>px4 serial port mapping</h3>
<p>ttyS (definition in the px4/microSD/etc/rc.txt) </p>
<p>HW (defined in the px4 hardware user manual)    </p>
<pre><code>    ttyS0 &lt;==&gt; HW-UART1     
    ttyS1 &lt;==&gt; HW-UART2     
    ttyS2 &lt;==&gt; HW-UART5     
    ttyS3 &lt;==&gt; HW-UART6

    UART_1 --- FTDI  
    pin3 --- black--ground
    pin7 --- yellow
    pin8 --- orange
</code></pre>
<h3>odroid cmu_mavlink</h3>
<pre><code>    git clone cmu_mavlink
    ./update --devel
</code></pre>
<h4>trouble shooting</h4>
<p><a href="https://github.com/gitlabhq/gitlabhq/issues/4272#issuecomment-22074932">Ref</a>  </p>
<p>odroid sandbox update failed like this: 
        [ 12%] Performing download step (git clone) for 'mavlink' <br>
        Cloning into 'mavlink'... <br>
        fatal: unable to access 'https://github.com/mavlink/mavlink.git/':   server certificate verification failed. CAfile: /etc/ssl/certs/ca-certificates.crt CRLfile: none <br>
solution: <br>
        git config --global http.sslverify false    </p>
<p>after the update: <br>
        catkin_make the dry;
        catkin_make the wet;</p>
<p>modify: vim cmu_mavlink/cmu_mavlink_only.launch   <br>
        baudrate:230400   <br>
        serialport:/dev/ttyUSB0</p>
<pre><code>    roslaunch cmu_mavlink cmu_mavlink_only.launch
    rostopic list
    rostopic hz /mavlink/att
    rostopic echo /mavlink/att
</code></pre>
<hr>
<h2>Feedback control using Simulation via Matlab and IPC</h2>
<h3>download cmu_quad_matlab to sandbox</h3>
<pre><code>git clone
./update  --devel
</code></pre>
<h3>compile the packages</h3>
<p>solve the problem in vicon-mocap      <br>
goto: cmu-quad-matlab/dry/src/vicon_mocap/libvicon_driver/</p>
<p>Change the line 24:</p>
<pre><code>from:

    set(USE_OLD_YAML_CPP_API TRUE CACHE BOOL "Use the old YAML-CPP API")

to:

    set(USE_OLD_YAML_CPP_API FALSE CACHE BOOL "Use the old YAML-CPP API")
</code></pre>
<p>catkin_make wet, it depends on some packages in dry, so before the compile we should source dry directory. (solution to problem "can't find mavlink".)</p>
<h3>. workon</h3>
<p>mehtod_1: manually source:
    firstly souce dry, then source wet
    source ${TOP_DIR}/dry/install_isolated/setup.bash
    source ${TOP_DIR}/wet/devel/setup.bash
method_2: use workon
add --extend to the second source line to make sure it works correctly.
there is a space between . and workon in command line</p>
<h3>let ROS talk to IPC-bridge</h3>
<pre><code>/opt/ipc/bin/central –u
</code></pre>
<h3>run Matlab.simple_io_test.m</h3>
<pre><code>cd /cmu_quad_matlab/wet/src/matlab_quadrotor_example/matlab
</code></pre>
<p><em>NOTE</em> <br>
<em>Be careful when trying to print out some information, which can greatly slow the processing speed.</em></p>
<h3>run launch file</h3>
<pre><code>cd cmu_quad_matlab/wet/src/matlab_quadrotor_example/launch
roslaunch matlab_quadrotor_example simulation_test.launch
rostopic list
rostopic hz topic-name
rostopic echo topic-name
</code></pre>
<h3>trouble shooting</h3>
<p>rostopic echo  /test/pd_cmd</p>
<p>ERROR: Cannot load message class for [quadrotor_msgs/PDCommand]. Are your messages built? </p>
<p>solution: source the directory using . workon in current terminal</p>
<hr>
<h2>Install mvBlueFOX camera driver on PC or Odroid</h2>
<p><a href="http://www.matrix-vision.com/manuals/mvBlueFOX/mvBF_page_quickstart.html">Matrix Vision mvBlueFOX Ref</a></p>
<p><a href="http://www.matrix-vision.com/industries-reader/embedded-boards-mvbluefox-drivers-for-odroid-raspberry-pi-and-wandboard.html">Driver for odroid</a></p>
<p><a href="http://www.matrix-vision.com/latest-drivers.html">Driver for Linux</a></p>
<h4>install <a href="http://sourceforge.net/projects/expat/">expat-2.1.0</a></h4>
<pre><code>    mkdir build                 in the expat-2.1.0 project folder
    cd build
    cmake ..                    
    make
    sudo make install

    ./configure
    make
    sudo make install
</code></pre>
<h4>install Linux camera driver mvBlueFOX-xxxxxxxxx</h4>
<p>download 2 files and run the following command:
        chmod a+x install_mvBlueFOX.sh 
        ./install_mvBlueFOX.sh </p>
<h4>test using wxPropView</h4>
<p>reboot<br>
test using
        wxPropView </p>
<hr>
<h2>install ROS-camera driver matrixvision_camera on PC</h2>
<ol>
<li>git clone matrixvision_camera from ethz Github
    export ROS_PACKAGE_PATH=${ROS_PACKAGE_PATH}:~/ros_code/matrixvision_camera/</li>
<li>rosmake</li>
<li>add files and modify some code from Ke's matrixvision Gitlab</li>
<li>rosmake</li>
<li>modify the launch file in mv_camera (camera ID)</li>
<li>roslaunch launchfile-name</li>
<li>
<p>rostopic list make sure the stereo camera are publishing:</p>
<pre><code>/stereo/left/image_raw
/stereo/left/camera_info
/stereo/right/image_raw
/stereo/right/camera_info
</code></pre>
</li>
<li>
<p>rostopic hz topic-name</p>
</li>
<li>rosrun image_view image_view image:=/stereo/left/image_raw</li>
</ol>
<blockquote>
<p>Difference between Ke and ethz:
1. copy from Ke to ethz:
    mv_camera/<br>
    {<br>
        CMakeLists.txt<br>
        launch<br>
        Makefile  <br>
        manifest.xml  <br>
    } <br>
    mv_camera/src <br>
    { <br>
        modify_camera_settings.cpp<br>
        stereo_time_reporter.cpp<br>
    }   <br>
2. comment some code:
    mv_camera/src/modify_camera_settings.cpp  <br>
    comment the last 4 sessions(set master and slave mode)</p>
</blockquote>
<p>copy camera calibration file
test image_view
test stereo_view</p>
<h2>Install ROS-camera driver on Odroid</h2>
<p>Before this step, we should install mvBlueFOX driver firstly. </p>
<ol>
<li>git clone matrixvision_camera from ethz Github
        export ROS_PACKAGE_PATH=${ROS_PACKAGE_PATH}:~/ros_code/matrixvision_camera/     </li>
<li>modify the make.sh file in the mv_driver folder   ---Arkin   see attached    </li>
<li>copy 4 folder from mv_driver/mvIMPACT_acquire to /opt/ros/indigo/include 
    DriverBase, mvDeviceManager, mvIMPACT_CPP, mvPropHandling
        sudo cp -r source-directory dest-directory<br>
<em>Note: the folder mv_driver/mvIMPACT_acquire will not exist until we rosmake it in directory matrixviaion_camera, but this rosmake will have some error.</em>   </li>
<li>rosmake it again, then it passed.    </li>
<li>modify the code according to Ke's code component </li>
<li>rosmake  </li>
<li>install ros-indigo-image-view package    </li>
<li>modify the launch file in the mv_camera for the two cameras UID  </li>
<li>roslaunch launchfile     </li>
<li>rostopic list       </li>
<li>rosrun image_view image_view image:=/stereo/left/image_raw  </li>
</ol>
<blockquote>
<p>Difference between Ke and ethz:
1. copy from Ke to ethz:
    mv_camera/<br>
    {<br>
        CMakeLists.txt<br>
        launch<br>
        Makefile  <br>
        manifest.xml  <br>
    } <br>
    mv_camera/src <br>
    { <br>
        modify_camera_settings.cpp<br>
        stereo_time_reporter.cpp<br>
    }   <br>
2. comment some code:
    mv_camera/src/modify_camera_settings.cpp  <br>
    comment the last 4 sessions(set master and slave mode)</p>
</blockquote>
<p><em>make.sh</em>    </p>
<pre><code>    #!/bin/bash   
    #This make.sh is for Odroid armv7l. Zheng Rong Nov 10 2014

    set -e

    PACKAGE_DIR=$(rospack find mv_driver)
    echo "### downloading and unpacking drivers to" $PACKAGE_DIR "###"

    BLUEFOX_URL="http://www.matrix-vision.com/industries-reader/embedded-boards-mvbluefox-drivers-for-odroid-raspberry-pi-and-wandboard.html?file=tl_files/mv11/support/mvIMPACT_Acquire_Embedded"

    API=mvIMPACT_acquire

    LINKER_PATHS=$PACKAGE_DIR/linker_paths
    COMPILER_FLAGS=$PACKAGE_DIR/compile_flags

    BLUEFOX_NAME=mvBlueFOX
    TARGET=armv7l
    BLUEFOX_VERSION=2.6.3
    BLUEFOX_TARNAME=$BLUEFOX_NAME-$TARGET-$BLUEFOX_VERSION

    # cleanup first
    rm -rf $BLUEFOX_NAME* $API* tmp $LINKER_PATHS $COMPILER_FLAGS
    rm -rf download
    #### download driver archives ####
    mkdir -p download
    cd download
    wget -O $BLUEFOX_TARNAME.tgz -nc $BLUEFOX_URL/$BLUEFOX_TARNAME.tgz

    #### bluefox runtime ####
    # unpack
    mkdir -p $PACKAGE_DIR/tmp/$BLUEFOX_NAME
    cd $PACKAGE_DIR/tmp/$BLUEFOX_NAME
    tar -xf $PACKAGE_DIR/download/$BLUEFOX_TARNAME.tgz --overwrite

    # copy blueFOX runtime libs
    mkdir -p $PACKAGE_DIR/$BLUEFOX_NAME"_runtime/lib/"$TARGET
    cp $PACKAGE_DIR/tmp/$BLUEFOX_NAME/$API-$TARGET-$BLUEFOX_VERSION/lib/$TARGET/libmvBlueFOX.* $PACKAGE_DIR/$BLUEFOX_NAME"_runtime/lib/"$TARGET

    # copy udev rule
    mkdir -p $PACKAGE_DIR/$BLUEFOX_NAME"_scripts"
    cp $PACKAGE_DIR/tmp/$BLUEFOX_NAME/$API-$TARGET-$BLUEFOX_VERSION/Scripts/51-mvbf.rules $PACKAGE_DIR/$BLUEFOX_NAME"_scripts"

    echo -L$PACKAGE_DIR/$BLUEFOX_NAME"_runtime/lib/"$TARGET &gt;&gt; $LINKER_PATHS

    ##### mvIMPACT (device independent stuff) #####===============  Arkin --Nov 11 2014
    cd $PACKAGE_DIR
    mv $PACKAGE_DIR/tmp/$BLUEFOX_NAME/$API-$TARGET-$BLUEFOX_VERSION $PACKAGE_DIR/$API
    echo -L$PACKAGE_DIR/$API/lib/$TARGET &gt;&gt; $LINKER_PATHS
    echo -I$PACKAGE_DIR/$API &gt;&gt; $COMPILER_FLAGS

    #### clean up ####
    rm -rf $PACKAGE_DIR/tmp

    #### note down that this is done ####
    touch $PACKAGE_DIR/downloadandinstall
</code></pre>
<hr>
<h2>Sychronization of the stereo camera</h2>
<p>Here are the connections we have for stereo cameras </p>
<p>The pin number follows the <a href="http://www.matrix-vision.com/manuals/mvBlueFOX/mvBF_page_tech.html#mvBF_subsection_single">link</a></p>
<p>Left: Master      <br>
Right: Slave</p>
<p>L7 -&gt; L10
L9 -&gt; R12
L8 -&gt; R8 &amp; R11</p>
<p>L: left, R:right (left camera is the one on your left when you stand behind the stereo camera pairs).</p>
<p>In the camera driver mv_camera:
The cpp file "modify_camera_settings" should contain the stereo camera sync code(master and slave).</p>
<hr>
<h2>using Stereo Image proc &amp; Image proc</h2>
<p>Packages: Image view, Stereo image proc, Image proc</p>
<p>After running the camera driver (mv_stereo.launch, in matrixvision_camera/mv_camera):</p>
<p><center><img alt="" src="image/stereo_image_proc.png"></p>
<ol>
<li>
<p>rostopic list make sure the stereo camera are publishing:</p>
<p>/stereo/left/image_raw
/stereo/left/camera_info
/stereo/right/image_raw
/stereo/right/camera_info</p>
</li>
<li>
<p>start stereo_image_proc in another terminal:   <br>
    ROS_NAMESPACE=stereo rosrun stereo_image_proc stereo_image_proc _approximate_sync:=True    </p>
</li>
<li>rostopic list</li>
<li>rostopic hz topic-name</li>
<li>
<p>see the iamge:     <br>
<em>image_view has 3 nodes: image_view, stereo_view, disparity_view</em>      </p>
<p>rosrun image_view image_view image:=/stereo/left/image_raw<br>
rosrun image_view stereo_view stereo:=/stereo image:=image_raw _approximate_sync:=True    <br>
rosrun image_view stereo_view stereo:=/stereo image:=image_rect _approximate_sync:=True   <br>
rosrun image_view disparity_view image:=/stereo/disparity       </p>
</li>
</ol>
<p>Image_proc is for mono camera, and has 1 node: image_proc.</p>
<p>function: remove camera distortion, convert format</p>
<p><center><img alt="" src="image/image_proc.png"></p>
<p>make sure the camera driver is running.</p>
<pre><code>rostopic list | grep image_raw
ROS_NAMESPACE=stereo/left rosrun image_proc image_proc
rosrun image_view image_view image:=stereo/left/image_raw
rosrun image_view image_view image:=stereo/left/image_rect
</code></pre>
<hr>
<h2>Calibration for Stereo /Mono Camera</h2>
<ol>
<li>
<p>make sure the installation of camera_calibration           <br>
    rosdep install camera_calibration
    rosmake camera_calibration</p>
</li>
<li>
<p>run the mv_stereo to start the stereo camera         <br>
    export ROS_PACKAGE_PATH=${ROS_PACKAGE_PATH}:~/ros_code/matrixvision_camera/
    roslaunch mv_camera.launch</p>
</li>
<li>
<p>check the topic    <br>
    rostopic list</p>
</li>
<li>
<p>run the calibration node     </p>
<p><em>Stereo</em>  </p>
<p>rosrun camera_calibration cameracalibrator.py --size 8x6 --square 0.152 --approximate=0.01 right:=/stereo/right/image_raw left:=/stereo/left/image_raw right_camera:=/stereo/right left_camera:=/stereo/left</p>
<p><em>Mono</em>   </p>
<p>rosrun camera_calibration cameracalibrator.py --size 8x6 --square 0.152 image:=/stereo/left/image_raw camera:=/stereo/left     </p>
</li>
<li>
<p>camera check</p>
<p>rosrun camera_calibration cameracheck.py --size 8x6 stereo:=/wide_stereo image:=image_rect</p>
<p>rosrun camera_calibration cameracheck.py --size 8x6 monocular:=/forearm image:=image_rect</p>
</li>
<li>
<p>check the stereo camera synchronization    <br>
    rosrun mv_camera stereo_time_reporter</p>
</li>
</ol>
<hr>
<h2>Record dataset as bagfile for SVO</h2>
<p>In the SVO package launch folder, there are several launch files:</p>
<pre><code>svo_bag.launch              *use dataset to test SVO algorithm and output results(bagfile)*
svo_imu_stereo_bag.launch   *record dataset as bagfile*
svo_imu_stereo.launch       *camera driver for stereo configuration*
svo_online.launch           *online svo*
svo_stereo_proc.launch      *start stereo image processing*
</code></pre>
<ol>
<li>
<p>run the camera driver</p>
<pre><code>roslaunch svo_imu_stereo.launch
The node "cam_configurer" should be under the group with namespace "vehicle".
In the matrixvision_camera/mv_camera/src/, the cpp file "modify_camera_settings" should contain the stereo camera sync code(master and slave).
in the stereo_visual_odometry/wet/src/stereo_visual_odometry/config folder, there should be mv_camera-ID.yaml.
</code></pre>
</li>
<li>
<p>run stereo image proc</p>
<pre><code>roslaunch svo_stereo_proc.launch
</code></pre>
</li>
<li>
<p>run recording process</p>
<pre><code>roslaunch svo_imu_stereo_bag.launch bagfile:=pc_svo_nov17_6
</code></pre>
</li>
</ol>
<p>You can specify the folder path of the bagfile output.</p>
<p>In the stereo_visual_odometry/wet/src/stereo_visual_odometry/config/oscar_camera_parameters.yaml, the projection matrices should be modified to match with the camera calibration result.</p>
<p>In the svo/src/visualOdometry.cpp  choose if dispaly the visual_feature_tracking</p>
<hr>
<h2>Run sandbox/stereo_visual_odometry using bag-file</h2>
<ol>
<li>
<p>mkdir sandbox</p>
<pre><code>cd sandbox  
git clone URL       
git branch -a       
git checkout -d branchname      
git branch      
git diff        
git fetch       
git pull        
git status      
cd stereo_visual_odometry       
./update --devel
</code></pre>
</li>
<li>
<p>set ROS_PACKAGE_PATH</p>
<pre><code>cd wet      
source devel/setup.bash     
env | grep ROS
</code></pre>
<p><em>bug solution</em></p>
<pre><code>unset ROS_PACKAGE_PATH      
remove the build folder     
rebuild
</code></pre>
<p><em>other methods</em></p>
<pre><code>. workon      
export ROS_PACKAGE_PATH=${ROS_PACKAGE_PATH}:~/sandbox/svo/wet
</code></pre>
</li>
<li>
<p>make  </p>
<pre><code>catkin_make -DCMAKE_BUILD_TYPE=Release
</code></pre>
</li>
<li>
<p>roslaunch  </p>
<pre><code>modify the launch file to fit for the bag file      
sandbox/svo/wet/src/svo/launch/     
roslaunch launch_name
</code></pre>
</li>
<li>
<p>rostopic</p>
<pre><code>rostopic list       
rostopic hz topic_name      
rostopic echo topic_name
</code></pre>
</li>
<li>
<p>rosnode</p>
<pre><code>rosbag info bag_name        
rosnode list        
rosnode info node_name
</code></pre>
</li>
<li>
<p>rosrun</p>
<pre><code>rosrun rviz rviz -d xxx.rviz
</code></pre>
</li>
</ol>
<hr>
<h2>use the CPU_monitor to get CPU usage information on Odroid</h2>
<ol>
<li>
<p>download the package cpu_monitor and put it in the package collection folder
    cd sandbox/svo/wet/src
    git clone URL</p>
</li>
<li>
<p>install needed glibtop library <br>
    sudo apt-get install libglib2.0-dev libgtop2-dev</p>
</li>
<li>
<p>make it<br>
    catkin_make --pkg cpu_monitor     #just make the specified package</p>
</li>
<li>
<p>modify the launch file</p>
</li>
<li>
<p>roslaunch svo_bag.launch output:=... input:=...  </p>
<p>rosbag info test_2014-11-14-11-15-33.bag
rosbag play test_2014-11-14-11-15-33.bag
rostopic echo /oscar/cpu_monitor/cpu_status</p>
</li>
<li>
<p>use Matlab slam_test_suite to plot the CPU usage.</p>
</li>
</ol>
<hr>
<h2>use the google performance tool <u>gperftools</u></h2>
<ol>
<li>
<p>download 
    <a href="https://code.google.com/p/gperftools/downloads/list">gperftools-2.1.tar.gz</a></p>
</li>
<li>
<p>install <a href="http://download.savannah.gnu.org/releases/libunwind/libunwind-0.99-beta.tar.gz">libunwind</a></p>
<p>./configure</p>
<p>Error when making libunwind:      <br>
/usr/include/bits/setjmp2.h:26: error: ‘longjmp’ aliased to undefined symbol ‘_longjmp’</p>
<p>Solution: modify the makefile     <br>
libunwind-1.0.1/src/Makefile      <br>
add U_FORTIFY_SOURCE for the CPPFLAGS on line 608.      </p>
<p>before: CPPFLAGS =  -D_GNU_SOURCE -DNDEBUG    <br>
after:  CPPFLAGS =  -D_GNU_SOURCE -DNDEBUG -U_FORTIFY_SOURCE</p>
<p><a href="http://blog.csdn.net/littletigerat/article/details/7738731">Ref</a></p>
</li>
<li>
<p>install <a href="https://code.google.com/p/gperftools/source/browse/INSTALL">gperftools</a></p>
<p>install command sequence:     <br>
./configure   <br>
make      <br>
make install      <br>
export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/usr/local/lib        </p>
</li>
<li>
<p><a href="http://gperftools.googlecode.com/svn/trunk/doc/cpuprofile.html">use</a></p>
</li>
</ol>
<h4>Example from Nate :-)</h4>
<ol>
<li>
<p>In CMakeLists, add link flags "profiler" and "tcmalloc"</p>
<pre><code>target_link_libraries(${PROJECT_NAME) ${catkin_LIBRARIES} ... profiler tcmalloc}
</code></pre>
</li>
<li>
<p>In the entry point of your programme(i.e. stereo_visual_odometry_bag_process.cc) </p>
<pre><code>#include &lt;gperftools/profiler.h&gt;
</code></pre>
</li>
<li>
<p>Wrap the entire node with: (should use the top level cc file)</p>
<pre><code>int main(int argc, char** argv)
{
    ProfilerStart("output_file_name");
    ....
    ProfilerStop();
    return EXIT_SUCCESS;
}
</code></pre>
</li>
<li>
<p>Recompile with flag -DCPUPROFILE_FREQUENCY=1000</p>
<pre><code>catkin_make -DCPUPROFILE_FREQUENCY=1000
</code></pre>
</li>
<li>
<p>roslaunch the launch file and wait for completion</p>
</li>
<li>
<p>you will find the output_file_name.prof</p>
<pre><code>cd ~/.ros/
</code></pre>
</li>
<li>
<p>text output of the CPU analysis result</p>
<pre><code>pprof --text ~/ros_code/sandbox/stereo_visual_odometry/wet/devel/lib/stereo_visual_odometry/stereo_visual_odometry_bag_process output_file_name.prof
</code></pre>
</li>
<li>
<p>graphical output you can do</p>
<pre><code>pprof --gv ~/ros_code/sandbox/stereo_visual_odometry/wet/devel/lib/stereo_visual_odometry/stereo_visual_odometry_bag_process output_file_name.prof
</code></pre>
</li>
</ol>
<p><em>Add link flags</em>
rosbuild_add_link_flags()
http://wiki.ros.org/rosbuild/CMakeLists/Examples</p>
<p>rosbuild_add_link_flags(target flags) :
http://wiki.ros.org/rosbuild/CMakeLists#rosbuild_add_link_flags</p>
<p>ROS_LINK_FLAGS:
http://wiki.ros.org/rosbuild</p>
<hr>
<h2>Set up ROS connection between two computers through ssh</h2>
<p>Master &lt;= ROS =&gt; Slave</p>
<p><em>Note: all the operation can be done on the laptop.</em></p>
<ul>
<li>
<p>Laptop:    </p>
<pre><code>ssh odroid@192.168.10.101(eth0) 200(wlan0)
</code></pre>
</li>
<li>
<p>Odroid terminal: (Master)</p>
<pre><code>roscore
export ROS_IP=192.....
export ROS_HOSTNAME=${ROS_IP}
export ROS_MASTER_URI=http://${ROS_IP}:11311
</code></pre>
</li>
<li>
<p>Laptop terminal:</p>
<pre><code>export ROS_IP=laptop's IP
export ROS_HOSTNAME=${laptop's ROS_IP}
export ROS_MASTER_URI=http://${odroid's ROS_IP}:11311
</code></pre>
</li>
<li>
<p>In ssh connection:</p>
<p>use scy command to copy file</p>
<pre><code>scp source_file odroid@192.168.10.101:~/.ros/camera_info/
</code></pre>
</li>
<li>
<p>run launch file    </p>
<p>in the terminals of laptop and odroid, run launch file separately.</p>
</li>
</ul>
<h2>Run ROS nodes on multiple machines using local launch file</h2>
<p><em>in the launch file, use 'machine' tag to specify the nodes will be running on the remote machiane</em>    </p>
<p><a href="http://pharos.ece.utexas.edu/wiki/index.php/Running_ROSNodes_in_several_robots_simultaneously_using_ROSLaunch">ref</a></p>
<p><a href="http://wiki.ros.org/roslaunch/XML/machine">ref</a></p>
<p>local machine: 192.168.10.100
remote machine: 192.168.10.51</p>
<p>1.in the launch file, declare the remote machine using 'machine' tag</p>
<pre><code>    &lt;machine name="quad" address="192.168.10.51" env-loader="~/baseline.sh" user="quad" password="quad"/&gt;
</code></pre>
<p>In the node, add machine="quad" like this:</p>
<pre><code>    &lt;node   machine="quad"
            pkg="stereo_image_proc"
            type="stereo_image_proc"
            name="rectifier"
            output="screen"
            args="_approximate_sync:=true"/&gt;
</code></pre>
<p>2.the env-loader is the environmental file it will need to run the nodes. It should be placed in the remote machine. Create a environment file in remote machine, which set the environment variable. The remote machine can know who is the ros-master and where to find the packages.</p>
<blockquote>
<p>baseline.sh</p>
</blockquote>
<pre><code>    #!/usr/bin/env bash

    . /opt/ros/hydro/setup.sh
    source /home/quad/git/sandbox/stereo_visual_odometry/dry/install_isolated/setup.bash
    source /home/quad/git/sandbox/stereo_visual_odometry/wet/devel/setup.bash

    export ROS_PACKAGE_PATH=${ROS_PACKAGE_PATH}:~/git/matrixvision_camera

    export ROS_IP=192.168.10.51
    export ROS_HOSTNAME=${ROS_IP}
    export ROS_MASTER_URI=http://192.168.10.100:11311

    exec "$@"
</code></pre>
<ol>
<li>Before roslaunch the launch file</li>
</ol>
<p>In the local machine, use</p>
<pre><code>export ROSLAUNCH_SSH_UNKNOWN=1
</code></pre>
<p>to let the roslaunch work with remote machine though it is not in the ssh-known-list.</p>
<p>and set: </p>
<pre><code>export ROS_IP=192.168.10.100
export ROS_HOSTNAME=${ROS_IP}
export ROS_MASTER_URI=http://192.168.10.100:11311
</code></pre>
<p>or you will get error like this:</p>
<p>remote[192.168.10.51-0]: Exception while registering with roslaunch parent [http://arkin-Think:56780/]: Traceback (most recent call last):
  File "/opt/ros/hydro/lib/python2.7/dist-packages/roslaunch/server.py", line 498, in _register_with_server
    code, msg, _ = server.register(name, self.uri)
  File "/usr/lib/python2.7/xmlrpclib.py", line 1224, in <strong>call</strong>
    return self.__send(self.__name, args)
  File "/usr/lib/python2.7/xmlrpclib.py", line 1578, in __request
    verbose=self.__verbose
    ......</p>
<p>We can place these items in a script: export</p>
<pre><code>    export ROS_IP=192.168.10.110
    export ROS_HOSTNAME=${ROS_IP}
    export ROS_MASTER_URI=http://192.168.10.110:11311
    export ROSLAUNCH_SSH_UNKNOWN=1
</code></pre>
<ol>
<li>roslaunch launch-file</li>
</ol>
<hr>
<h2>Vicon</h2>
<h3>Using Vicon_mocap package</h3>
<p>it includes:
<em> vicon
</em> vicon_odom</p>
<p>after downloading by git clone, place it in the dry folder, then compile it.</p>
<pre><code>    catkin_make_isolated
    catkin_make_isolated --install --pkg vicon_mocap
</code></pre>
<p><em>For the old version 'vicon' package from Github, compile vicon and vicon_odom separately by rosmake, before which you should export the directory</em></p>
<pre><code>    export ROS_PACKAGE_PATH=${ROS_PACKAGE_PATH}:~/git/sandbox/vicon_mocap/vicon
    export ROS_PACKAGE_PATH=${ROS_PACKAGE_PATH}:~/git/sandbox/vicon_mocap/vicon_odom
</code></pre>
<p><em>TBD</em> </p>
<pre><code>    set -fPIC flag in libVicon_driver folder CMakelists.txt, add:
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fPIC")
    set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -fPIC")
</code></pre>
<h3>Vicon node</h3>
<p>NOTE: </p>
<p>the remap name from "~vicon" in "vicon_odom" must be the same with the name of topic "vicon" publishes.
This will connect node "vicon" with node "vicon_odom".
"vicon" publish the topic /vicon/base_obj with the type of vicon/subject
"vicon_odom" should subscribe the /vicon/base_obj and then
"vicon_odom" can publish the topic /vicon/odom with the type of nav_msg/Odometry</p>
<pre><code>    &lt;!-- Vicon system, publish /vicon/base_obj --&gt;
    &lt;node   pkg="vicon"
            type="vicon"
            name="vicon"
            output="screen"&gt;
    &lt;param name="vicon_server" value="192.168.10.1"/&gt;
    &lt;/node&gt;
    &lt;!-- publish /vicon/base_obj --&gt;

    &lt;!-- Specify a Vicon object --&gt;

    &lt;node   pkg="vicon_odom"
            type="vicon_odom"
            name="$(arg baseline)_vicon_odom"
            output="screen"&gt;
    &lt;param name="frame_id/fixed" value="vicon"/&gt;
    &lt;param name="frame_id/base" value="$(arg baseline)/base"/&gt;
    &lt;remap from="~vicon" to="/vicon/base_obj"/&gt;
    &lt;remap from="~odom" to="/vicon/odom"/&gt;
    &lt;/node&gt;
</code></pre>
<h3>Vicon model creation and calibration</h3>
<p><a href="http://oryx.rasl.ri.cmu.edu/index.php?title=RASL:Infrastructure">REF</a></p>
<p><em>Get the real position of the center point of the robot. This is to compensate the relative T and R between vicon-object and real robot.</em></p>
<p>1.work in cmu_quad_matlab</p>
<p>2.install marks on the robot</p>
<p>3.creat an object named "india" in vicon system</p>
<p>4.place robot on the calibration board with correct direction</p>
<p>5.select "india" and "QuadrotorCalib2" in vicon system</p>
<p><em>india is the robot and QuadrotorCalib2 is the calibration board.</em></p>
<p>6.dry/src/vicon_mocap/vicon
modify the launch/calibrate.launch, 
model name=india
vicon_server:192.168.10.1</p>
<p>7.modify the conf/QuadrotorCalib.yaml as following:</p>
<pre><code>    markers:
    - name: M1
      position: [0.334964, 0.020655, -0.06959]
    - name: M2
      position: [0.166135, -0.157154, -0.06959]
    - name: M3
      position: [-0.145480, -0.208342, -0.06959]
    - name: M4
      position: [-0.176013, -0.125724, -0.06959]
    - name: M6
      position: [-0.144582, 0.241569, -0.06959]
    - name: M7
      position: [0.163890, 0.168380, -0.06959]
</code></pre>
<p><em>Note that the z-coordinates of the marker points represent the offset of the quadrotor's tip path plane to the calibration board's IR marker plane.</em></p>
<p>For the mini-quad calibration test stand, use:</p>
<pre><code>    markers:
    - name: M1
      position: [-0.2223,0.0178,-0.0285]
    - name: M2
      position: [-0.2032,-0.0686,-0.0285]
    - name: M3
      position: [0.0483,0.1841,-0.0285]
    - name: M4
      position: [0.2007,0.1829,-0.0285]
    - name: M5
      position: [0.0737,-0.1867,-0.0285]
    - name: M6
      position: [0.0930,-0.1118,-0.0285]
    - name: M7
      position: [0.2032,-0.1994,-0.0285]
</code></pre>
<p>8.copy the "launch", "calib", and "conf" folders into "sandbox/cmu_quad_matlab/dry/install_isolated/share/vicon</p>
<p>9.roslaunch vicon calibrate.launch</p>
<p>In a new terminal:
        rostopic list
        #(echo)
        /rosout
        /rosout_agg
        /vicon/QuadrotorCalib2
        /vicon/QuadrotorCalibMini
        /vicon/india
        /vicon/lp2
        /vicon/november
        /vicon_calibrate/zero_pose</p>
<pre><code>    rostopic echo /vicon_calibrate/zero_pose
    #(echo)
    nothing
</code></pre>
<p>In a new terminal:</p>
<pre><code>    rosservice call /vicon_calibrate/toggle_calibration

    #Untoggle calibration routine by entering same command again

    rosservice call /vicon_calibrate/toggle_calibration
</code></pre>
<p>10.The calibration file "india.yaml" should be written to vicon/ros/vicon/calib/india.yaml</p>
<hr>
<h2>C++ CMake</h2>
<p>cmake
cmake ..
make
./xxx(executable file)</p>
<hr>
<h2>Matlab</h2>
<ul>
<li>set up shortcut as Windows</li>
</ul>
<h3>slam_test_suite</h3>
<ul>
<li>
<p>correspondence</p>
<pre><code>svo/absolute_odom ==&gt; svt
vicon/odom ==&gt; vic
</code></pre>
</li>
<li>
<p>before use      <br>
1.change the topic name in the bag_interfece from line 14;    <br>
2.change the display options in plot_options from line 12;    <br>
3.change the vehicle_name in plot_options from line 2;      </p>
</li>
</ul>
<hr>
<h2>Command about rostopic / rosmsg</h2>
<p>rostopic list
rostopic type topic-name</p>
<p>rosmsg show</p>
<hr>
<p>in the launch file, for the parameter setting, it seems that we must use absolute path.</p>
</body>
</html>
